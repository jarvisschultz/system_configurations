(push "~/.emacs.d/" load-path)

;; add marmalade functionality:
(require 'package)
(add-to-list 'package-archives 
    '("marmalade" .
      "http://marmalade-repo.org/packages/"))
(add-to-list 'package-archives 
    '("melpa" .
      "http://melpa.milkbox.net/packages/") 'APPEND)
(package-initialize)


;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;; EMACS PERFORMED CUSTOMIZATIONS ;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
(custom-set-faces
 ;; custom-set-faces was added by Custom.
 ;; If you edit it by hand, you could mess it up, so be careful.
 ;; Your init file should contain only one such instance.
 ;; If there is more than one, they won't work right.
 )
(add-to-list 'default-frame-alist '(font . "DejaVu Sans Mono-10"))
(custom-set-variables
 ;; custom-set-variables was added by Custom.
 ;; If you edit it by hand, you could mess it up, so be careful.
 ;; Your init file should contain only one such instance.
 ;; If there is more than one, they won't work right.
 '(LaTeX-command "latex --src-specials")
 '(ansi-color-names-vector ["#3f3f3f" "#cc9393" "#7f9f7f" "#f0dfaf" "#8cd0d3" "#dc8cc3" "#93e0e3" "#dcdccc"])
 '(column-number-mode t)
 '(custom-safe-themes (quote ("71b172ea4aad108801421cc5251edb6c792f3adbaecfa1c52e94e3d99634dee7" "bf9d5728e674bde6a112979bd830cc90327850aaaf2e6f3cc4654f077146b406" default)))
 '(fci-rule-color "#383838")
 '(highlight-nonselected-windows t)
 '(matlab-comment-line-s "% ")
 '(matlab-comment-on-line-s "% ")
 '(matlab-comment-region-s "% ")
 '(matlab-shell-ask-MATLAB-for-completions nil)
 '(preview-auto-cache-preamble t)
 '(preview-gs-options (quote ("-q" "-dNOSAFER" "-dNOPAUSE" "-DNOPLATFONTS" "-dPrinted" "-dTextAlphaBits=4" "-dGraphicsAlphaBits=4")))
 '(preview-scale-function 1.25)
 '(safe-local-variable-values (quote ((TeX-auto-parse-length . 999999) (TeX-auto-regexp-list . TeX-auto-full-regexp-list) (TeX-parse-self . t) (TeX-auto-save . t))))
 '(save-place t nil (saveplace))
 '(show-paren-mode t)
 '(warning-suppress-types (quote ((\(quote\ \(\(undo\ discard-info\)\)\)))))
 '(wdired-allow-to-change-permissions t))




;;;;;;;;;;;;;;;;;
;; KEYBINDINGS ;;
;;;;;;;;;;;;;;;;;
;; Bind a new key for changing line wrapping properties:
(define-key global-map [f5] 'toggle-truncate-lines)
(setq-default truncate-lines t)
(setq truncate-partial-width-windows nil) ;; for vertically-split windows
;; Bind a key for compiling code:
(global-set-key [f12] 'compile)
;; Miscellaneous bindings:
(global-set-key "\M-g" 'goto-line)
(global-set-key [f10] 'shell)
;; add shortcuts for splitting and changing windows
(global-set-key (kbd "M-1") 'delete-other-windows)
(global-set-key (kbd "M-2") 'split-window-vertically)
(global-set-key (kbd "M-3") 'split-window-horizontally)
(global-set-key (kbd "M-4") 'other-window)
;; bind regex forward and backward search to a easier keyboard
;; commands:
(global-set-key (kbd "C-M-s") 'isearch-forward-regexp)
(global-set-key (kbd "C-M-r") 'isearch-backward-regexp)
;; Modifty the command for parsing LaTeX errors to be compatible with
;; icicles:
(global-set-key (kbd "C-c C-`") 'TeX-next-error)
(global-set-key (kbd "C-c C-g") 'top-level)
;; bind key for the new emacs24 function count-words
(global-set-key (kbd "C-c C-=") 'count-words)
;; add a second keybinding for scrolling through errors... don't like
;; the backtick:
(global-set-key (kbd "C-c n") 'next-error)
;; add keybinding for browsing kill ring
(global-set-key (kbd "C-c C-y") 'browse-kill-ring)
;; make hippie-expand my default expansion:
(global-set-key (kbd "M-/") 'hippie-expand)
;; add key for using tag expand:
(global-set-key (kbd "M-RET") 'complete-tag)


;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;; WINDOWS, GRAPHICS AND APPEARANCE SETTINGS ;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;; Turn on window saving mode for restoring window configs:
(winner-mode 1)
(toggle-scroll-bar -1)
(column-number-mode 1)
(setq inhibit-startup-message t)
(setq-default fill-column 80) ;; set default fill column value
;; Set the default window size if we are not running in the no window option:
(if (window-system) (set-frame-height (selected-frame) 47))
(if (window-system) (set-frame-width (selected-frame) 102))
;; Turn on syntax highlighting
(global-font-lock-mode t)
;; turn off menu bars:
(if (fboundp 'tool-bar-mode) (tool-bar-mode -1))
(if (fboundp 'menu-bar-mode) (menu-bar-mode -1))
;; enable clipboard yanking
(setq x-select-enable-clipboard t)
;; turn on shell auto-coloring by default
(setq ansi-color-for-comint-mode t)
;; add color functionality
(add-to-list 'load-path "~/.emacs.d/themes")
(add-to-list 'custom-theme-load-path "~/.emacs.d/themes/")
(require 'color-theme)
(require 'color-theme-tango)
(eval-after-load "color-theme"
  '(progn
     (color-theme-initialize)))
(setq color-theme-is-global nil)

(defvar after-make-console-frame-hooks '()
"Hooks to run after creating a new TTY frame")
(defvar after-make-window-system-frame-hooks '()
"Hooks to run after creating a new window-system frame")

(defun run-after-make-frame-hooks (frame)
"Selectively run either `after-make-console-frame-hooks' or
`after-make-window-system-frame-hooks'"
(select-frame frame)
(run-hooks (if window-system
'after-make-window-system-frame-hooks
'after-make-console-frame-hooks)))

(defun set-my-custom-window-settings ()
  "remove scroll bar and set window size"
  (toggle-scroll-bar -1)
  (set-frame-width (selected-frame) 98)
  (set-frame-height (selected-frame) 48)
  (load-theme 'zenburn t)
)

(defun set-my-custom-terminal-settings ()
  "run any commands specific to no-window mode"
  ;; (load-theme 'zenburn t)
  )

(add-hook 'after-make-frame-functions 'run-after-make-frame-hooks)
(add-hook 'after-init-hook
(lambda () (run-after-make-frame-hooks (selected-frame))))

(add-hook 'after-make-window-system-frame-hooks
	  'set-my-custom-window-settings)
(add-hook 'after-make-console-frame-hooks
	  'set-my-custom-terminal-settings)
;; (add-hook 'after-make-window-system-frame-hooks 'color-theme-tango)
;; (add-hook 'after-make-console-frame-hooks 'color-theme-dark-gnus)





;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;; MISCELLANEOUS BEHAVIORS OF BUILT IN PACKAGES ;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
(setq make-backup-files nil)
(put 'scroll-left 'disabled nil)
;; Enter also indents in cc-mode
(defun my-make-CR-do-indent ()
   (define-key c-mode-base-map "\C-m" 'c-context-line-break))
(add-hook 'c-initialization-hook 'my-make-CR-do-indent)
;; Choose default cc-mode styles
(setq c-default-style '((other . "linux")))
(setq c-basic-offset 4)
;; Turn on CamelCase mode by default
(add-hook 'c-mode-common-hook
	  (lambda () (subword-mode 1)))
(add-hook 'c++-mode-common-hook
	  (lambda () (subword-mode 1)))
(add-hook 'python-mode-hook
	  (lambda () (subword-mode 1)))
;; set the value of the macro ring buffer
(setq kmacro-ring-max 20)
;; enable delete-selection-mode
(delete-selection-mode)
;; add tramp functionality:
(require 'tramp)
(setq tramp-default-method "scp")
;; start server if not already running when using just 'emacs' on
;; command line
(require 'server)
(or (server-running-p)
    (server-start))
;; something keeps resetting the XML indentation settings
(setq nxml-child-indent 2)
;; for narrowing editing to a single region:
(put 'narrow-to-region 'disabled nil)
;; don't want browsing kill ring to mess up my display:
(setq browse-kill-ring-quit-action 'save-and-restore)
;; use recentf to store a list of recent files across sessions:
(require 'recentf)
(recentf-mode 1)
;; enable dired+ instead of dired and turn on "a" command
(require 'dired+)
(put 'dired-find-alternate-file 'disabled nil)
(setq dired-omit-files "^\\...+$")
;; add keybinding for activating wdired-mode
(add-hook 'dired-mode-hook 
	  (lambda () (define-key dired-mode-map 
	    (kbd "C-c C-q") 'wdired-change-to-wdired-mode)))



;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;; OTHER PACKAGE LOADING AND CONFIGURATIONS ;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;; add miscellaneous packages dir to load path
(add-to-list 'load-path "~/.emacs.d/misc-packages/")
;; Add functionality for expand region:
(require 'expand-region)
(global-set-key (kbd "C-=") 'er/expand-region)
(global-set-key (kbd "C-+") 'er/contract-region)
;; add functionality for art-bollocks mode
;(require 'artbollocks-mode)
;; add functionality for textlint mode
(add-to-list 'load-path "~/.emacs.d/textlint/")
(require 'textlint)
;; fix commenting problems in xml mode
(require 'mz-comment-fix)
(add-to-list 'comment-strip-start-length (cons 'nxml-mode 3))
;; add mathematica mode:
(require 'mathematica)
;; add functionality for magit mode
(require 'magit)
;; Add functionality for rosemacs
(add-to-list 'load-path "/home/jarvis/ros/stacks/rosemacs/")
(require 'rosemacs)
(invoke-rosemacs)
;; add a keymap for using rosemacs commands
(global-set-key "\C-x\C-r" ros-keymap)
;; add my function that joins a region into a single line
(require 'join-region)


;; AUTOCOMPLTE MODE ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;; Add autocomplete package:
(add-to-list 'load-path "~/.emacs.d/auto-complete-extras/")
(require 'auto-complete-config)
(ac-config-default)
(define-key global-map (kbd "<C-tab>") 'ac-fuzzy-complete)
(auto-complete-mode)
(setq ac-ignore-case nil)
;; (add-to-list 'ac-dictionary-directories "~/.emacs.d/elpa/auto-complete-1.4/dict/")
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;




;; LATEX ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;; Add Latex functionality
(require 'tex)
(require 'my-auctex-plugins.el)
(setq-default TeX-master nil)
(setq TeX-parse-self t)
(setq TeX-auto-save t)
(setq TeX-electric-sub-and-superscript t)
;; Add reverse LaTeX searching:
(setq TeX-source-specials-mode 1)
(setq Tex-source-specials-view-start-server t)
(add-to-list 'TeX-command-list '("View" "%V" TeX-run-discard nil t))
(add-to-list 'TeX-output-view-style 
	     '("^dvi$" "." 
	       "%(o?)xdvi -watchfile 1 %dS %d"))
;; turn on reftex by default
(add-hook 'LaTeX-mode-hook 'reftex-mode)
(add-hook 'bibtex-mode-hook 'reftex-mode)
;; make reftex use frametitle and lecture for TOC
(add-hook 'reftex-load-hook
	  (lambda ()
	    (setq reftex-section-levels
		  (cons '("frametitle" . 7) 
			reftex-section-levels))))
;; makes reftex use cleveref for all styles by default:
(defun reftex-format-cref (label def-fmt)
  (format "\\cref{%s}" label))
(setq reftex-format-ref-function 'reftex-format-cref)
;; add LaTeX-auto-complete mode
(require 'ac-math)
(add-to-list 'ac-modes 'latex-mode)   ; make auto-complete aware of {{{latex-mode}}}
(defun ac-latex-mode-setup ()         ; add ac-sources to default ac-sources
  (setq ac-sources
     (append '(ac-source-math-unicode ac-source-math-latex ac-source-latex-commands)
               ac-sources))
)
(add-hook 'LaTeX-mode-hook 'auto-complete-mode)
(add-hook 'LaTeX-mode-hook 'ac-latex-mode-setup)
(ac-flyspell-workaround)
;; Binding for running a bash script:
(define-key TeX-mode-map [f11] (lambda() (interactive) (shell-command "./LatexCompile")))
;; binding for my indent function
(add-hook 'LaTeX-mode-hook (lambda () (define-key
					LaTeX-mode-map (kbd "<f9>") 
					'indent-region-as-c)))
;; binding for compiling beamer frames
(add-hook 'LaTeX-mode-hook (lambda () (define-key
					LaTeX-mode-map (kbd "\C-\M-x") 
					'tex-beamer-frame)))
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
 



;; PYTHON ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;; add python functionality
(require 'python-mode)
(fset 'python-beginning-of-line
   "\C-a\223\\w\C-b")
(add-hook 'python-mode-hook (function (lambda () (define-key
						   python-mode-map (kbd "M-a")
						   'python-beginning-of-line))))
;; (add-to-list 'load-path "/home/jarvis/src/emacs_stuff/python-mode.el-6.0.10/")
;; (add-to-list 'load-path "/home/jarvis/src/emacs_stuff/python-mode.el-6.0.10/completion/")
;; (setq py-install-directory "/home/jarvis/src/emacs_stuff/python-mode.el-6.0.10/")
;; (require 'ipython)
;; make python mode recognize _ as a word separator
(modify-syntax-entry ?_ "_" py-mode-syntax-table)
(modify-syntax-entry ?_ "_" python-mode-syntax-table)
(add-hook 'python-mode-hook 'highlight-indentation)
;; enable cython-mode
(require 'cython-mode)
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;





;; FLYSPELL ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;; Turn on FlySpell for some things by default
;(add-hook 'c-mode-hook 'flyspell-prog-mode) ;; for individual modes
(setq flyspell-use-meta-tab nil)
(add-hook 'text-mode-hook 'turn-on-flyspell)
(add-hook 'change-log-mode-hook 'turn-on-flyspell)
(add-hook 'tex-mode-hook 'turn-on-flyspell)
(add-hook 'tex-mode-hook (function (lambda () (setq ispell-parser 'tex))))
(add-hook 'texinfo-mode
	  '(lambda () (setq flyspell-generic-check-word-p
			    'texinfo-mode-flyspell-verify)))
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;



;; MATLAB ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;; Add matlab-emacs mode
(add-to-list 'load-path "~/src/emacs_stuff/matlab-emacs/")
;(load-library "matlab-load")
(autoload 'matlab-mode "matlab" "Matlab Editing Mode" t)
(add-to-list
 'auto-mode-alist
 '("\\.m$" . matlab-mode))
(setq matlab-indent-function t)
(setq matlab-shell-command "matlab")
(setq matlab-shell-command-switches '("-nodesktop"))
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;



;; PROCESSING ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;; Add processing-emacs mode
(add-to-list 'load-path "~/src/emacs_stuff/processing-emacs/")
(autoload 'processing-mode "processing-mode" "Processing mode" t)
(add-to-list 'auto-mode-alist '("\\.pde$" . processing-mode))
(setq processing-location "~/processing-1.5.1/")
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;



;; ICICLES ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;; Icicle functionality
(require 'icicles)
(setq icicle-expand-input-to-common-match-flag nil)
(setq icicle-search-replace-common-match-flag nil)
(setq icicle-incremental-completion-flag nil)
(setq icicle-region-background "#4f4f4f")
;; turn on icicles by default
(icy-mode 1)
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;



;; BUFFER MOVE ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
(require 'buffer-move)
(global-set-key (kbd "<C-S-up>")     'buf-move-up)
(global-set-key (kbd "<C-S-down>")   'buf-move-down)
(global-set-key (kbd "<C-S-left>")   'buf-move-left)
(global-set-key (kbd "<C-S-right>")  'buf-move-right)
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;



;; RECENTF CUSTOMIZATIONS ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
(setq recentf-last-list '())
(defun recentf-save-if-changes ()
  "If the file list has changed, we will re-save it."
  (unless (equalp recentf-last-list recentf-list)
    (setq recentf-last-list recentf-list)
    (recentf-save-list)))
(run-at-time t 300 'recentf-save-if-changes) ;; run occasionally
(add-to-list 'recentf-exclude "\\.recentf\\'") 
(add-to-list 'recentf-exclude ".*\\.git/.*\\'")
(global-set-key (kbd "C-c f") 'recentf-open-files)
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
